generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(uuid())
  email    String  @unique
  password String?
  name     String?
  photo    String?
  googleId String? @unique // ðŸ‘ˆ Add this new field

  chats       Chat[]
  rooms       Room[] @relation("AdminRooms") // Rooms created/owned by this user
  collabRooms Room[] @relation("CollabRooms") // Rooms where this user is a guest
}

model Room {
  id        Int      @id @default(autoincrement())
  slug      String   @unique
  createdAt DateTime @default(now())

  // The Admin (Owner) of the room
  adminId String
  admin   User   @relation("AdminRooms", fields: [adminId], references: [id])

  // The Collaborators (Guests) - Many-to-Many relationship
  collaborators User[] @relation("CollabRooms")

  chats  Chat[]
  shapes Shape[] // ðŸ‘ˆ Add relation
}

model Chat {
  id      Int    @id @default(autoincrement())
  roomId  Int
  message String
  userId  String

  room Room @relation(fields: [roomId], references: [id])
  user User @relation(fields: [userId], references: [id])
}

// 2. Create this new Model
model Shape {
  id     String @id // Excalidraw uses string IDs (e.g., "element-1")
  roomId Int
  data   String // We will store the full JSON shape object as a string

  room Room @relation(fields: [roomId], references: [id])

  @@index([roomId])
}
